<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Gift Challenge ðŸ’•</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
    margin:0;
    min-height:100vh;
    background:linear-gradient(135deg,#fff0f3,#ffb3c1);
    font-family:'Comic Sans MS',cursive;
    text-align:center;
    color:#d63384;
}

h1{
    font-size:2.6em;
    margin-top:40px;
    color:#ff1493;
}

p{
    font-size:1.2em;
}

#container{
    position:relative;
    width:90%;
    max-width:850px;
    height:70vh;
    margin:40px auto;
    border:10px solid #ff69b4;
    border-radius:30px;
    background:white;
    overflow:hidden;
    touch-action:none;
}

canvas{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}

button{
    padding:16px 55px;
    font-size:1.3em;
    border:none;
    border-radius:50px;
    cursor:pointer;
    margin:20px;
}

#done-btn{ background:#ff69b4; color:white; }
#clear-btn{ background:#ffe4e1; color:#d63384; }

#success{
    display:none;
    font-size:2em;
    margin-top:30px;
    color:#ff1493;
}
</style>
</head>

<body>

<h1>Draw Increase in Love & Cuteness ðŸ’•</h1>
<p>Draw upward shift in my love (Demand) and your cuteness (Supply).</p>

<div id="container">
    <canvas id="graph"></canvas>
    <canvas id="draw"></canvas>
</div>

<button id="done-btn">Done ðŸ’•</button>
<button id="clear-btn">Clear</button>

<div id="success">
    You did ittt ðŸ˜ŒðŸ’—<br><br>
    <button onclick="window.location.href='journey.html'">Next Test â†’ ðŸ’•</button>
</div>

<!-- ðŸŽµ MUSIC ADDED -->
<audio id="bgMusic" autoplay loop>
    <source src="take-me.mp3" type="audio/mpeg">
</audio>

<script>

/* Fix autoplay block */
document.body.addEventListener("click", function() {
    document.getElementById("bgMusic").play();
}, { once: true });

const graph = document.getElementById("graph");
const draw = document.getElementById("draw");
const ctxGraph = graph.getContext("2d");
const ctxDraw = draw.getContext("2d");
const container = document.getElementById("container");

function resizeCanvas(){
    const rect = container.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;

    graph.width = draw.width = rect.width * dpr;
    graph.height = draw.height = rect.height * dpr;

    graph.style.width = draw.style.width = rect.width + "px";
    graph.style.height = draw.style.height = rect.height + "px";

    ctxGraph.setTransform(dpr,0,0,dpr,0,0);
    ctxDraw.setTransform(dpr,0,0,dpr,0,0);

    drawAxes();
}

window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function drawAxes(){
    ctxGraph.clearRect(0,0,graph.width,graph.height);
    ctxGraph.lineWidth=4;
    ctxGraph.strokeStyle="#444";

    const m=70;
    const w=container.clientWidth;
    const h=container.clientHeight;

    ctxGraph.beginPath();
    ctxGraph.moveTo(m,m);
    ctxGraph.lineTo(m,h-m);
    ctxGraph.lineTo(w-m,h-m);
    ctxGraph.stroke();
}

let drawing=false,lastX=0,lastY=0;

ctxDraw.lineCap="round";
ctxDraw.lineJoin="round";
ctxDraw.strokeStyle="#ff69b4";
ctxDraw.lineWidth=6;

function getPos(e){
    const rect=draw.getBoundingClientRect();
    return{
        x:e.clientX-rect.left,
        y:e.clientY-rect.top
    };
}

draw.addEventListener("pointerdown",e=>{
    drawing=true;
    draw.setPointerCapture(e.pointerId);
    const pos=getPos(e);
    lastX=pos.x;
    lastY=pos.y;
});

draw.addEventListener("pointermove",e=>{
    if(!drawing) return;
    const pos=getPos(e);

    ctxDraw.beginPath();
    ctxDraw.moveTo(lastX,lastY);
    ctxDraw.quadraticCurveTo(lastX,lastY,(lastX+pos.x)/2,(lastY+pos.y)/2);
    ctxDraw.stroke();

    lastX=pos.x;
    lastY=pos.y;
});

draw.addEventListener("pointerup",()=>drawing=false);
draw.addEventListener("pointerleave",()=>drawing=false);

document.getElementById("clear-btn").onclick=()=>{
    ctxDraw.clearRect(0,0,draw.width,draw.height);
    document.getElementById("success").style.display="none";
};

document.getElementById("done-btn").onclick=()=>{
    document.getElementById("success").style.display="block";
    confetti({particleCount:200,spread:120});
};
</script>

</body>
</html>
